<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLP Explanation - DS4420 Spotify Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.8.0/recharts.min.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 0;
            padding: 0;
            background-color: #f9fafb;
        }
        .chart-container {
            width: 100%;
            height: 320px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto p-6 bg-white min-h-screen">
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Multi-Layer Perceptron (MLP) Explanation</h1>
            <p class="text-gray-600">Interactive example using DS4420 Spotify playlist data</p>
        </div>

        <div class="mb-6">
            <div class="flex space-x-2 mb-4 overflow-x-auto" id="step-buttons">
                <!-- Buttons will be generated by JavaScript -->
            </div>
        </div>

        <div class="bg-white border rounded-lg p-6 min-h-96" id="content-area">
            <!-- Content will be loaded here -->
        </div>

        <div class="mt-6 flex justify-between">
            <button id="prev-btn" class="px-4 py-2 bg-gray-500 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                Previous
            </button>
            <button id="next-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                Next
            </button>
        </div>
    </div>

    <script>
        // Sample data based on DS4420 Spotify playlist
        let spotifyData = [];
        let processedData = [];
        let currentStep = 0;

        const mlpWeights = {
            layer1: [[0.5, -0.3, 0.8, 0.2], [0.7, 0.4, -0.5, 0.6], [-0.2, 0.9, 0.3, -0.4]],
            layer2: [[0.6], [-0.8], [0.4]]
        };

        // Initialize with sample data (fallback for when CSV can't be loaded)
        function initializeData() {
            const sampleData = [
                {
                    id: 0,
                    song_title: "Hard to Concentrate",
                    artist_name: "Red Hot Chili Peppers",
                    releaseYear: 0.53, // 2006 normalized ((2006-1990)/30)
                    duration: 0.67, // ~4 minutes normalized (4/6)
                    explicit: 0,
                    artistPop: 0.86,
                    hasGenres: 1,
                    trackPop: 60
                },
                {
                    id: 1,
                    song_title: "Faya",
                    artist_name: "Aya Nakamura",
                    releaseYear: 0.93, // 2018
                    duration: 0.46, // ~2.8 minutes
                    explicit: 0,
                    artistPop: 0.74,
                    hasGenres: 1,
                    trackPop: 44
                },
                {
                    id: 2,
                    song_title: "Sunflower - Spider-Man: Into the Spider-Verse",
                    artist_name: "Post Malone",
                    releaseYear: 0.93, // 2018
                    duration: 0.44, // ~2.6 minutes
                    explicit: 0,
                    artistPop: 0.90,
                    hasGenres: 0,
                    trackPop: 82
                },
                {
                    id: 3,
                    song_title: "Heartless",
                    artist_name: "Kanye West",
                    releaseYear: 0.60, // 2008
                    duration: 0.59, // ~3.5 minutes
                    explicit: 0,
                    artistPop: 0.92,
                    hasGenres: 1,
                    trackPop: 82
                },
                {
                    id: 4,
                    song_title: "Don't Think Twice, It's All Right",
                    artist_name: "Bob Dylan",
                    releaseYear: -0.9, // 1963 (very old!)
                    duration: 0.60, // ~3.6 minutes
                    explicit: 0,
                    artistPop: 0.77,
                    hasGenres: 1,
                    trackPop: 67
                },
                {
                    id: 5,
                    song_title: "Shape of You",
                    artist_name: "Ed Sheeran",
                    releaseYear: 0.90, // 2017
                    duration: 0.52, // ~3.1 minutes
                    explicit: 0,
                    artistPop: 0.88,
                    hasGenres: 1,
                    trackPop: 85
                },
                {
                    id: 6,
                    song_title: "Bohemian Rhapsody",
                    artist_name: "Queen",
                    releaseYear: -0.5, // 1975
                    duration: 1.0, // ~6 minutes
                    explicit: 0,
                    artistPop: 0.87,
                    hasGenres: 1,
                    trackPop: 78
                },
                {
                    id: 7,
                    song_title: "Blinding Lights",
                    artist_name: "The Weeknd",
                    releaseYear: 1.0, // 2020
                    duration: 0.57, // ~3.4 minutes
                    explicit: 0,
                    artistPop: 0.89,
                    hasGenres: 1,
                    trackPop: 88
                },
                {
                    id: 8,
                    song_title: "Watermelon Sugar",
                    artist_name: "Harry Styles",
                    releaseYear: 1.0, // 2020
                    duration: 0.48, // ~2.9 minutes
                    explicit: 0,
                    artistPop: 0.91,
                    hasGenres: 1,
                    trackPop: 76
                },
                {
                    id: 9,
                    song_title: "Levitating",
                    artist_name: "Dua Lipa",
                    releaseYear: 1.0, // 2020
                    duration: 0.61, // ~3.7 minutes
                    explicit: 0,
                    artistPop: 0.88,
                    hasGenres: 1,
                    trackPop: 79
                }
            ];

            processedData = sampleData;
            spotifyData = sampleData; // Use same data for both
        }

        // MLP forward pass simulation
        function forwardPass(inputs) {
            // Layer 1: Input to hidden layer
            const hidden = mlpWeights.layer1.map(weights => {
                const sum = inputs.reduce((acc, input, idx) => acc + input * weights[idx], 0);
                return Math.max(0, sum); // ReLU activation
            });
            
            // Layer 2: Hidden to output layer
            const output = mlpWeights.layer2.reduce((acc, weights, idx) => 
                acc + hidden[idx] * weights[0], 0
            );
            
            return { 
                hidden, 
                output: Math.max(0, Math.min(100, output * 50 + 50)) // Scale to 0-100
            };
        }

        // Create scatter plot using SVG
        function createScatterPlot() {
            const chartData = processedData.slice(0, 8).map(track => {
                const inputs = [track.releaseYear, track.duration, track.explicit, track.artistPop];
                const prediction = forwardPass(inputs).output;
                return {
                    name: track.song_title.length > 20 ? track.song_title.substring(0, 17) + '...' : track.song_title,
                    actual: track.trackPop,
                    predicted: prediction,
                    error: Math.abs(track.trackPop - prediction)
                };
            });

            const maxVal = 100;
            const width = 500;
            const height = 280;
            const margin = 60;

            let svg = `<svg width="${width}" height="${height}" style="background: white; border-radius: 8px;">`;
            
            // Grid lines
            for (let i = 0; i <= maxVal; i += 25) {
                const x = margin + (i / maxVal) * (width - 2 * margin);
                const y = height - margin - (i / maxVal) * (height - 2 * margin);
                
                // Vertical grid lines
                svg += `<line x1="${x}" y1="${margin}" x2="${x}" y2="${height - margin}" stroke="#f3f4f6" stroke-width="1"/>`;
                // Horizontal grid lines
                svg += `<line x1="${margin}" y1="${y}" x2="${width - margin}" y2="${y}" stroke="#f3f4f6" stroke-width="1"/>`;
            }
            
            // Axes
            svg += `<line x1="${margin}" y1="${height - margin}" x2="${width - margin}" y2="${height - margin}" stroke="#374151" stroke-width="2"/>`;
            svg += `<line x1="${margin}" y1="${height - margin}" x2="${margin}" y2="${margin}" stroke="#374151" stroke-width="2"/>`;
            
            // Axis labels
            svg += `<text x="${width/2}" y="${height - 10}" text-anchor="middle" class="text-sm font-medium">Actual Popularity</text>`;
            svg += `<text x="20" y="${height/2}" text-anchor="middle" transform="rotate(-90, 20, ${height/2})" class="text-sm font-medium">Predicted Popularity</text>`;
            
            // Scale numbers
            for (let i = 0; i <= maxVal; i += 25) {
                const x = margin + (i / maxVal) * (width - 2 * margin);
                const y = height - margin - (i / maxVal) * (height - 2 * margin);
                svg += `<text x="${x}" y="${height - margin + 15}" text-anchor="middle" class="text-xs">${i}</text>`;
                svg += `<text x="${margin - 10}" y="${y + 3}" text-anchor="end" class="text-xs">${i}</text>`;
            }
            
            // Data points
            chartData.forEach((point, idx) => {
                const x = margin + (point.actual / maxVal) * (width - 2 * margin);
                const y = height - margin - (point.predicted / maxVal) * (height - 2 * margin);
                
                svg += `<circle cx="${x}" cy="${y}" r="6" fill="#8884d8" stroke="white" stroke-width="2" opacity="0.8">`;
                svg += `<title>${point.name}&#10;Actual: ${point.actual}&#10;Predicted: ${point.predicted.toFixed(1)}&#10;Error: ${point.error.toFixed(1)}</title>`;
                svg += `</circle>`;
                
                // Add song labels for some points to make it more interactive
                if (idx < 4) {
                    svg += `<text x="${x + 10}" y="${y - 10}" class="text-xs fill-gray-600">${point.name.split(' ')[0]}</text>`;
                }
            });
            
            svg += '</svg>';
            return svg;
        }

        // Step content definitions
        const steps = [
            {
                title: "1. Problem Setup: Predicting Track Popularity",
                content: () => `
                    <div class="space-y-4">
                        <p>We'll use the DS4420 Spotify dataset to predict track popularity using an MLP neural network.</p>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Our Dataset Features:</h4>
                            <ul class="space-y-1 text-sm">
                                <li><strong>Input Features:</strong> Release Year, Duration, Explicit Content, Artist Popularity</li>
                                <li><strong>Target:</strong> Track Popularity (0-100)</li>
                                <li><strong>Sample Size:</strong> ${processedData.length} songs from DS4420 class</li>
                            </ul>
                        </div>
                        <div class="mt-4">
                            <h5 class="font-medium mb-2">Sample Data (First 5 Tracks):</h5>
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-xs border border-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="border p-2">Song</th>
                                            <th class="border p-2">Year</th>
                                            <th class="border p-2">Duration</th>
                                            <th class="border p-2">Explicit</th>
                                            <th class="border p-2">Artist Pop</th>
                                            <th class="border p-2">Track Pop</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${processedData.slice(0, 5).map(track => `
                                            <tr>
                                                <td class="border p-2">${track.song_title}</td>
                                                <td class="border p-2">${Math.round(track.releaseYear * 30 + 1990)}</td>
                                                <td class="border p-2">${(track.duration * 6).toFixed(1)}m</td>
                                                <td class="border p-2">${track.explicit ? 'Yes' : 'No'}</td>
                                                <td class="border p-2">${Math.round(track.artistPop * 100)}</td>
                                                <td class="border p-2">${track.trackPop}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                title: "2. MLP Architecture",
                content: () => `
                    <div class="space-y-4">
                        <p>Our MLP has a simple architecture for this regression task:</p>
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="text-center">
                                    <div class="bg-green-100 p-3 rounded-lg mb-2">
                                        <h4 class="font-semibold">Input Layer</h4>
                                        <p class="text-sm">4 neurons</p>
                                    </div>
                                    <ul class="text-xs space-y-1">
                                        <li>Release Year</li>
                                        <li>Duration</li>
                                        <li>Explicit</li>
                                        <li>Artist Pop</li>
                                    </ul>
                                </div>
                                
                                <div class="text-center mx-8">
                                    <div class="bg-blue-100 p-3 rounded-lg mb-2">
                                        <h4 class="font-semibold">Hidden Layer</h4>
                                        <p class="text-sm">3 neurons</p>
                                    </div>
                                    <p class="text-xs">ReLU activation</p>
                                </div>
                                
                                <div class="text-center">
                                    <div class="bg-purple-100 p-3 rounded-lg mb-2">
                                        <h4 class="font-semibold">Output Layer</h4>
                                        <p class="text-sm">1 neuron</p>
                                    </div>
                                    <p class="text-xs">Track Popularity</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="bg-yellow-50 p-3 rounded">
                                <h5 class="font-medium">Weights Layer 1→2:</h5>
                                <pre class="text-xs mt-1">${mlpWeights.layer1.map((w, i) => `H${i+1}: [${w.map(v => v.toFixed(1)).join(', ')}]`).join('\n')}</pre>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded">
                                <h5 class="font-medium">Weights Layer 2→3:</h5>
                                <pre class="text-xs mt-1">${mlpWeights.layer2.map((w, i) => `Out: [${w[0].toFixed(1)}]`).join('\n')}</pre>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                title: "3. Forward Pass Example",
                content: () => {
                    const track = processedData[0];
                    const inputs = [track.releaseYear, track.duration, track.explicit, track.artistPop];
                    const result = forwardPass(inputs);
                    
                    return `
                        <div class="space-y-4">
                            <p>Let's trace through the forward pass for the first track in our dataset:</p>
                            <div class="space-y-4">
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold">Input: "${track.song_title}" by ${track.artist_name}</h4>
                                    <div class="grid grid-cols-4 gap-2 mt-2 text-sm">
                                        <div>Year: ${track.releaseYear.toFixed(2)}</div>
                                        <div>Duration: ${track.duration.toFixed(2)}</div>
                                        <div>Explicit: ${track.explicit}</div>
                                        <div>Artist Pop: ${track.artistPop.toFixed(2)}</div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold">Hidden Layer Calculations:</h4>
                                    ${result.hidden.map((h, idx) => `
                                        <div class="text-sm mt-1">
                                            <span class="font-mono">
                                                H${idx+1} = ReLU(${inputs.map((inp, i) => `${inp.toFixed(2)}×${mlpWeights.layer1[idx][i].toFixed(1)}`).join(' + ')}) = ${h.toFixed(3)}
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold">Output Calculation:</h4>
                                    <div class="text-sm">
                                        <span class="font-mono">
                                            Output = ${result.hidden.map((h, i) => `${h.toFixed(3)}×${mlpWeights.layer2[i][0].toFixed(1)}`).join(' + ')} = ${result.output.toFixed(1)}
                                        </span>
                                    </div>
                                    <div class="mt-2 p-2 bg-white rounded">
                                        <strong>Predicted Popularity: ${result.output.toFixed(1)}</strong> vs <strong>Actual: ${track.trackPop}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            },
            {
                title: "4. Predictions vs Actual",
                content: () => `
                    <div class="space-y-4">
                        <p>Let's see how our MLP performs on several tracks:</p>
                        <div class="chart-container">
                            ${createScatterPlot()}
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Model Insights:</h4>
                            <ul class="text-sm space-y-1">
                                <li>• The model learns patterns between artist popularity, song characteristics, and track success</li>
                                <li>• Hidden layers capture non-linear relationships (e.g., optimal song duration, era effects)</li>
                                <li>• ReLU activation helps model complex interactions between features</li>
                                <li>• This is a simplified example - real models would need more data and training!</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                title: "5. Key MLP Concepts",
                content: () => `
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">Forward Propagation</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Data flows from input → hidden → output</li>
                                    <li>• Each layer applies: weights × inputs + bias</li>
                                    <li>• Activation functions introduce non-linearity</li>
                                    <li>• Our example uses ReLU: f(x) = max(0, x)</li>
                                </ul>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">Universal Approximation</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• MLPs can approximate any continuous function</li>
                                    <li>• Hidden layers capture complex patterns</li>
                                    <li>• More layers = more complex representations</li>
                                    <li>• Our music features → popularity mapping</li>
                                </ul>
                            </div>
                            
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">Training Process</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Backpropagation adjusts weights</li>
                                    <li>• Minimize prediction error (loss function)</li>
                                    <li>• Gradient descent optimization</li>
                                    <li>• Requires labeled training data</li>
                                </ul>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">Applications</h4>
                                <ul class="text-sm space-y-1">
                                    <li>• Classification (genre prediction)</li>
                                    <li>• Regression (popularity prediction)</li>
                                    <li>• Recommendation systems</li>
                                    <li>• Feature extraction and learning</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-gray-100 p-4 rounded-lg mt-4">
                            <h4 class="font-semibold mb-2">Try This With Your Data:</h4>
                            <ol class="text-sm space-y-1">
                                <li>1. <strong>Student Success Prediction:</strong> Use the student survey data to predict GPA based on study habits</li>
                                <li>2. <strong>Music Genre Classification:</strong> Predict genre from audio features</li>
                                <li>3. <strong>Course Recommendation:</strong> Suggest courses based on student profiles</li>
                                <li>4. <strong>Engagement Prediction:</strong> Predict which students will participate more based on background</li>
                            </ol>
                        </div>
                    </div>
                `
            }
        ];

        // Navigation functions
        function renderStepButtons() {
            const container = document.getElementById('step-buttons');
            container.innerHTML = steps.map((_, idx) => `
                <button
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap step-btn ${
                        currentStep === idx ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }"
                    data-step="${idx}"
                >
                    Step ${idx + 1}
                </button>
            `).join('');

            // Add click listeners
            document.querySelectorAll('.step-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    currentStep = parseInt(e.target.dataset.step);
                    updatePage();
                });
            });
        }

        function renderContent() {
            const container = document.getElementById('content-area');
            container.innerHTML = `
                <h2 class="text-xl font-semibold mb-4">${steps[currentStep].title}</h2>
                ${steps[currentStep].content()}
            `;
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === steps.length - 1;
            
            prevBtn.onclick = () => {
                if (currentStep > 0) {
                    currentStep--;
                    updatePage();
                }
            };
            
            nextBtn.onclick = () => {
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    updatePage();
                }
            };
        }

        function updatePage() {
            renderStepButtons();
            renderContent();
            updateNavigation();
        }

        // Initialize the page
        function init() {
            initializeData();
            updatePage();
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>